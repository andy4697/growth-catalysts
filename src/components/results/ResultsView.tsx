"use client";
import { useState } from "react";
import { motion } from "framer-motion";
import {
  Users, Radio, MessageSquare, DollarSign,
  Check, RotateCcw, Copy,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Separator } from "@/components/ui/separator";
import { GtmCard } from "./GtmCard";
import { WildcardCard } from "./WildcardCard";
import { ContactsSection } from "./ContactsSection";
import { CompetitorsSection } from "./CompetitorsSection";
import { GtmPlan } from "@/types/gtm";

interface ResultsViewProps {
  plan: GtmPlan;
  onStartOver: () => void;
}

export function ResultsView({ plan, onStartOver }: ResultsViewProps) {
  const [copied, setCopied] = useState(false);

  const buildCopyText = () => {
    const competitorLines = (plan.gemini.competitors ?? [])
      .map((c, i) => `  ${i + 1}. ${c.name} â€” ${c.description}\n     Your gap: ${c.gap}`)
      .join("\n");

    const contactLines = (plan.contacts ?? [])
      .map((c, i) => `  ${i + 1}. ${c.name} â€” ${c.title} at ${c.company}${c.linkedin_url ? `\n     LinkedIn: ${c.linkedin_url}` : ""}`)
      .join("\n");

    return `GTM SPARK â€” YOUR GO-TO-MARKET PLAN
=====================================

ðŸŽ¯ TARGET CUSTOMER (ICP)
${plan.gemini.icp}

ðŸ“¡ BEST CHANNEL
${plan.gemini.channel}

ðŸ’¬ ONE-LINE PITCH
${plan.gemini.pitch}

ðŸ’° PRICING MODEL
${plan.gemini.pricing}

âš”ï¸ COMPETITIVE LANDSCAPE
${competitorLines}

ðŸ‘¥ PEOPLE TO REACH OUT TO
${contactLines}

âœ¨ SURPRISE OPPORTUNITY (Wildcard)
Audience: ${plan.wildcard.audience}
Why it works: ${plan.wildcard.rationale}

---
Generated by GTM Spark`.trim();
  };

  const handleCopy = async () => {
    await navigator.clipboard.writeText(buildCopyText());
    setCopied(true);
    setTimeout(() => setCopied(false), 2500);
  };

  const gtmCards = [
    { title: "Target Customer (ICP)", content: plan.gemini.icp, icon: Users, accentColor: "border-l-blue-500" },
    { title: "Best Channel", content: plan.gemini.channel, icon: Radio, accentColor: "border-l-green-500" },
    { title: "One-Line Pitch", content: plan.gemini.pitch, icon: MessageSquare, accentColor: "border-l-purple-500" },
    { title: "Pricing Model", content: plan.gemini.pricing, icon: DollarSign, accentColor: "border-l-orange-500" },
  ];

  return (
    <div className="w-full max-w-xl space-y-6 pb-8">
      {/* Header */}
      <motion.div
        initial={{ opacity: 0, y: -10 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.35 }}
        className="text-center"
      >
        <div className="inline-flex items-center gap-1.5 bg-green-500/10 text-green-400 px-3 py-1 rounded-full text-xs font-medium mb-3">
          <Check className="w-3 h-3" />
          Plan ready
        </div>
        <h2 className="text-2xl font-bold tracking-tight">Your GTM Plan</h2>
        <p className="text-muted-foreground text-sm mt-1">
          Strategy by Gemini Â· Contacts & Wildcard by Happenstance
        </p>
      </motion.div>

      {/* GTM strategy cards */}
      <div className="space-y-3">
        {gtmCards.map((card, i) => (
          <GtmCard key={card.title} title={card.title} content={card.content} icon={card.icon} index={i} accentColor={card.accentColor} />
        ))}
      </div>

      <Separator className="opacity-40" />

      {/* Competitors */}
      {plan.gemini.competitors?.length > 0 && (
        <CompetitorsSection competitors={plan.gemini.competitors} />
      )}

      <Separator className="opacity-40" />

      {/* Real contacts */}
      {plan.contacts?.length > 0 && (
        <ContactsSection contacts={plan.contacts} isMocked={plan.contactsMocked} />
      )}

      <Separator className="opacity-40" />

      {/* Wildcard */}
      <WildcardCard insight={plan.wildcard} isMocked={plan.isMocked} index={0} />

      {/* Actions */}
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: 0.9, duration: 0.3 }}
        className="flex gap-3 pt-2"
      >
        <Button onClick={handleCopy} className="flex-1 gap-2" variant="outline">
          {copied ? (
            <><Check className="w-4 h-4 text-green-500" />Copied!</>
          ) : (
            <><Copy className="w-4 h-4" />Copy Full Plan</>
          )}
        </Button>
        <Button onClick={onStartOver} variant="ghost" className="gap-2">
          <RotateCcw className="w-4 h-4" />
          Start Over
        </Button>
      </motion.div>
    </div>
  );
}
